{% extends "base.html" %}

{% load humanize %}

{% block content %}
<div class="row">

  <div class="col-lg-10">

    <div class="mb-4">
      <h3>State</h3>

      <div>
        <strong>Status:</strong>
        <code>{{ job.status }}</code>
      </div>

      <div>
        <strong>Started:</strong> {{ job.started }}
      </div>

      <div>
        <strong>Status Code:</strong>
        {% if job.status_code %}
        <code>{{ job.status_code }}</code>
        {% else %}-{% endif %}
      </div>

      <div>
        <strong>Status Message:</strong>
        {% if job.status_message %}
        <code>{{ job.status_message }}</code>
        {% else %}-{% endif %}
      </div>

    </div>

    <div class="mb-5">
      <h3>Config</h3>

      <div>
        <strong>Backend:</strong>
        <code>{{ job.job_request.backend }}</code>
      </div>

      <div>
        <strong>Action:</strong>
        <code>{{ job.action_id }}</code>
      </div>

      <div>
        <strong>Force run?:</strong>
        <code>{{ job.force_run }}</code>
      </div>

      {% if not job.workspace %}
      <div>
        <strong>Workspace:</strong>
        <a href="{% url 'workspace-detail' pk=job.job_request.workspace.pk %}">
          {{ job.job_request.workspace.name }}
        </a>
        <small class="text-muted">({{ job.job_request.workspace.branch }})</small>
      </div>
      {% else %}
      <div>
        <strong>Workspace:</strong>
        <a href={% url 'workspace-detail' pk=job.workspace.pk %}>
          {{ job.workspace.name }}
        </a>
        <small class="text-muted">({{ job.workspace.branch }})</small>
      </div>
      {% endif %}

      {% if job.job_request_id %}
      <div>
        <strong>Request:</strong>
        <a href={% url 'job-request-detail' pk=job.job_request.pk %}>
          {{ job.job_request_id }} by {{ job.job_request.created_by.username }}
        </a>
      </div>
      {% endif %}

    </div>

    <div class="mb-5">
      <h3>Timings</h3>

      <div>
        <strong>Created:</strong>
        <span title="{{ job.created_at|date:"Y-m-d H:i:s" }}">
          {{ job.created_at|naturaltime }}
        </span>
      </div>

      <div>
        <strong>Started:</strong>
        <span title="{{ job.started_at|default_if_none:"" }}">
          {{ job.started_at|naturaltime|default_if_none:"-" }}
        </span>
      </div>

      <div>
        <strong>Finished:</strong>
        <span title="{{ job.completed_at|default_if_none:"" }}">
          {{ job.completed_at|naturaltime|default_if_none:"-"}}
        </span>
      </div>
    </div>

  </div>

  <div class="col-lg-2">

    <h3 class="text-center">Tools</h3>

    {% if request.user.is_superuser %}
    <form method="POST" action="{% url 'job-zombify' pk=job.pk %}">
      {% csrf_token %}

      <button class="btn btn-block btn-danger" type="submit">Zombify</button>
    </form>
    {% endif %}

  </div>

</div>
{% endblock content %}
