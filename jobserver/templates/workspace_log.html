{% extends "base.html" %}

{% load selected_filter %}

{% block metatitle %}Logs: {{ workspace.name }} | OpenSAFELY Jobs{% endblock metatitle %}

{% block breadcrumbs %}
{% if workspace.is_archived %}
  <div class="alert alert-warning text-center mb-0" role="warning">
    <div class="container">
      <div class="row">
        <div class="col">
          <p>
            This Workspace has been archived.  Logs are still available but new Jobs can no longer be requested.
          </p>
          <p class="mb-0">
            If you think this has been done in error, please contact an <a href="mailto:team@opensafely.org">admin</a>.
          </p>
        </div>
      </div>
    </div>
  </div>
{% endif %}

<nav class="breadcrumb-container" aria-label="breadcrumb">
  <div class="container">
    <ol class="breadcrumb rounded-0 mb-0 px-0">
      <li class="breadcrumb-item">
        <a href="/">Home</a>
      </li>

      <li class="breadcrumb-item">
        <a href="{{ workspace.project.org.get_absolute_url }}">
          {{ workspace.project.org.name }}
        </a>
      </li>

      <li class="breadcrumb-item">
        <a href="{{ workspace.project.get_absolute_url }}">
          {{ workspace.project.name }}
        </a>
      </li>

      <li class="breadcrumb-item">
        <a href="{{ workspace.get_absolute_url }}">
          {{ workspace.name }}
        </a>
      </li>

      <li class="breadcrumb-item active" aria-current="page">
        Logs
      </li>
    </ol>
  </div>
</nav>
{% endblock breadcrumbs %}

{% block jumbotron %}
<div class="jumbotron jumbotron-fluid pt-md-2">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-xl-9 d-flex flex-column align-items-start justify-content-center">
        <h1>{{ workspace.name }}</h1>
        <p class="lead">
          Below are the logs for each job run in the
          <a href="{{ workspace.get_absolute_url }}">{{ workspace.name }}</a>
          workspace of the project
          <a href="{{ workspace.project.get_absolute_url }}">{{ workspace.project.name }}</a>.
          They are grouped based on the actions which were requested.
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock jumbotron %}

{% block content %}
<div class="job-list">
  <div class="container">
    <div class="row">
      <form class="col-lg-10 offset-lg-1 col-xl-8 offset-xl-2 form d-flex align-items-center mb-4" method="GET">
        <label for="searchJobLogs" class="sr-only">Search by Job action or ID</label>
        <input
          id="searchJobLogs"
          class="form-control mr-2"
          type="search"
          placeholder="Search by Job action or ID"
          aria-label="Search"
          name="q" />
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
      </form>

      <form class="d-flex justify-content-between align-items-center mb-2" method="GET">

        <div class="form-group">
          <div class="btn-group-toggle" data-toggle="buttons">
            {% for backend in backends %}
              {% is_filter_selected key="backend" value=backend.slug as is_active %}
              <label class="btn btn-sm btn-outline-success">
                <input type="checkbox" name="backend" {% if is_active %}checked {% endif %}value="{{ backend.slug }}" />
                {{ backend.name }}
              </label>
            {% endfor %}
          </div>
        </div>

        <div class="form-group">
          <button class="btn btn-outline-success" type="submit">Filter</button>
        </div>

      </form>
    </div>
  </div>


  {% if not page_obj %}
  <div class="text-center">
    <p>
      No results found, try checking the <a href={% url 'job-list' %}>Event Log</a>.
    <p>
  </div>
  {% else %}

    {% include "_job_requests.html" %}

  {% endif %}

</div>
{% endblock content %}
