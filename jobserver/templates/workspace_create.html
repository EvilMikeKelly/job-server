{% extends "base.html" %}

{% load django_vite %}

{% block content %}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">

    <li class="breadcrumb-item"><a href="/">Home</a></li>

    <li class="breadcrumb-item">
      <a href="{{ project.org.get_absolute_url }}">
        {{ project.org.name }}
      </a>
    </li>

    <li class="breadcrumb-item">
      <a href="{{ project.get_absolute_url }}">
        {{ project.name }}
      </a>
    </li>

    <li class="breadcrumb-item active" aria-current="page">Create a Workspace</li>

  </ol>
</nav>

<div class="row">
  <div class="col-md-8 offset-md-2">
    <h3 class="mb-3">Create a Workspace</h3>

    <form method="POST">
      {% csrf_token %}

      {% if form.non_field_errors %}
      <ul>
        {% for error in form.non_field_errors %}
        <li class="text-danger">{{ error }}</li>
        {% endfor %}
      </ul>
      {% endif %}

      <div class="form-group row">
        <label for="id_name" class="col-sm-2 col-form-label">Name</label>
        <div class="col-sm-10">
          <input
            type="text"
            class="form-control"
            id="id_name"
            name="name"
            aria-describedby="nameHelpBlock"
            required
            {% if not form %}
            disabled
            {% endif %}
            {% if form.name.value %}
            value="{{ form.name.value }}"
            {% endif %}
          />
          <small id="nameHelpBlock" class="form-text text-muted">
            Enter a descriptive name which makes this workspace easy to
            identify.  It will also be the name of the directory in which you
            will find results after jobs from this workspace are run.
          </small>

          {% if form.name.errors %}
          <ul class="pl-3 mb-1">
            {% for error in form.name.errors %}
            <li class="text-danger">{{ error }}</li>
            {% endfor %}
          </ul>
          {% endif %}

        </div>
      </div>

      <div class="form-group row">
        <label for="id_repo" class="col-sm-2 col-form-label">Repo</label>
        <div class="col-sm-10">
          <select
            id="id_repo"
            class="form-control"
            name="repo"
            required
            {% if not form %}
            disabled
            {% endif %}
            aria-describedby="repoHelpBlock">
            {% for value, label in form.repo.field.choices %}
            <option value="{{ value }}"{% if value == form.repo.value %} selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <small id="repoHelpBlock" class="form-text text-muted">
            If your repo doesn't show up here, reach out to the OpenSAFELY team on Slack.
          </small>

          {% if form.repo.errors %}
          <ul class="pl-3 mb-1">
            {% for error in form.repo.errors %}
            <li class="text-danger">{{ error }}</li>
            {% endfor %}
          </ul>
          {% endif %}

        </div>
      </div>

      <div class="form-group row">
        <label for="id_branch" class="col-sm-2 col-form-label">Branch</label>
        <div class="col-sm-10">
          <select
            id="id_branch"
            class="form-control"
            name="branch"
            required
            {% if not form %}
            disabled
            {% endif %}
            >
            {% for value, label in form.branch.field.choices %}
            <option value="{{ value }}"{% if value == form.branch.value %} selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>

          {% if form.branch.errors %}
          <ul class="pl-3 mb-1">
            {% for error in form.branch.errors %}
            <li class="text-danger">{{ error }}</li>
            {% endfor %}
          </ul>
          {% endif %}

        </div>
      </div>

      <div class="row">
        <pre>
        {{ form.branch.value }}
        </pre>
      </div>

      <div class="form-group row">
        <div class="col-sm-10">
          <button type="submit" class="btn btn-primary"{% if not form %} disabled{% endif %}>Save</button>
        </div>
      </div>

    </form>

  </div>
</div>
{% endblock content %}

{% block extra_js %}
{{ repos_with_branches|json_script:"reposWithBranches" }}
{% vite_asset 'assets/src/scripts/workspace_create.js' %}
{% vite_asset 'assets/src/scripts/workspace_create-legacy.js' scripts_attrs=scripts_attrs %}
{% endblock %}
