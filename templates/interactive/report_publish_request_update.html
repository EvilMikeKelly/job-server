{% extends "base-tw.html" %}

{% block metatitle %}View report publishing request | OpenSAFELY Jobs{% endblock metatitle %}

{% block breadcrumbs %}
  {% url "home" as home_url %}

  {% #breadcrumbs %}
    {% breadcrumb title="Home" url=home_url %}
    {% breadcrumb title=object.report.project.org.name url=object.report.project.org.get_absolute_url location="Organisation" %}
    {% breadcrumb title=object.report.project.name url=object.report.project.get_absolute_url location="Project" %}
    {% breadcrumb title=object.report.title url=object.report.analysis_request.get_absolute_url location="Analysis Request" %}
    {% breadcrumb title="Publish report request" active=True %}
  {% /breadcrumbs %}
{% endblock breadcrumbs %}

{% block content %}
<div class="grid gap-4 max-w-3xl mb-6">
  <h1 class="text-3xl tracking-tight break-words font-bold text-slate-900 sm:text-4xl">
    Publish request for {{ object.report.title }}
  </h1>

  {% #button type="link" href=object.report.analysis_request.get_absolute_url variant="primary" class="flex flex-shrink-0 w-fit" %}
    View report
  {% /button %}

  <form method="POST">
    {% csrf_token %}

    {% #card class="mb-4" %}
      {% #description_item title="Created by" %}
      {{ object.created_by.name }}
      {% /description_item %}

      {% #description_item title="Analysis request (with report)" %}
      {% link href=object.report.analysis_request.get_absolute_url text=object.report.title %}</p>
      {% /description_item %}

      {% #description_item title="Report release file" %}
      {% link href=object.report.release_file.get_absolute_url text="View in outputs-viewer" %}</p>
      {% /description_item %}

      {% #description_item title="Approved at" %}
      {{ object.approved_at|default:"-" }}
      {% /description_item %}

      {% #description_item title="Approved by" %}
      {{ object.approved_by.name|default:"-" }}
      {% /description_item %}
    {% /card %}

    {% #button type="submit" variant="success" disabled=object.approved_at %}Approve{% /button %}
  </form>
</div>

{% endblock %}
