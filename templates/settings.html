{% extends "base-tw.html" %}

{% block metatitle %}Settings | OpenSAFELY Jobs{% endblock metatitle %}

{% block breadcrumbs %}
  {% #breadcrumbs %}
    {% url 'home' as home_url %}
    {% breadcrumb title="Home" url=home_url %}

    {% url 'settings' as settings_url %}
    {% breadcrumb title="Settings" active=True %}
  {% /breadcrumbs %}
{% endblock breadcrumbs %}

{% block content %}
  <section class="grid md:grid-cols-3">
    <h1 class="md:col-span-3 text-3xl break-words md:text-4xl font-bold text-slate-900">
      Settings
    </h1>

    {% if not form.fullname.value %}
      {% #alert variant="warning" title="Update needed" class="md:col-span-2 mt-4" %}
        Your OpenSAFELY profile is missing information, please add your name to your account.
      {% /alert %}
    {% endif %}

    <form method="POST" class="md:col-span-2 mt-6">
      {% csrf_token %}

      {% #card title="Your account" class="w-full" container_class="flex flex-col gap-y-4 items-start" container=True %}
        {% form_input autocapitalize="words" autocomplete="name" autocorrect="on" class="min-w-full" field=form.fullname label="Full name" required=True type="text" %}
        {% form_input autocapitalize="off" autocomplete="email" autocorrect="off" class="min-w-full" field=form.notifications_email label="Contact Email" inputmode="email" required=True type="email" %}
        {% #button type="submit" name="settings" variant="primary" %}
          Save your settings
        {% /button %}
      {% /card %}
    </form>

    {% if request.user.social_auth.exists %}
      {% #card title="Generate Single Use Token" subtitle="For logging in to OpenSAFELY from secure Level 4 environments, you need to generate a single use login token." container=True %}
        {% if token %}
          <div class="prose prose-sm mb-6">
          <p>Here is your single use token:</p>
          <pre style="flex-basis: auto">{{ token }}</pre>
          <p>
            You can use this to login to OpenSAFELY from within secure Level 4 environments.
            It is valid for 1 hour, or until you use it or re-generate it.
          </p>
          </div>
        {% endif %}
        <form class="flex items-center gap-2 flex-wrap md:col-span-3 md:flex-nowrap" method="POST">
          {% csrf_token %}
          {% #button type="submit" name="token" variant="success" %}
            Generate Single Use Token
          {% /button %}
        </form>
      {% /card %}
    {% endif %}
  </section>
{% endblock %}
