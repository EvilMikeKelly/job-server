# 15. Provide option to login by token for access from Level 4
Date: 2023-04-05

## Status
Accepted

## Context

To use the output viewer, and the future release process we plan to build on
it, you need to login to job-server from the Level 4 VM.

This currently involves logging via Github, as that's the only log in option we
support. This has two significant drawbacks:

1. Users have to enter their full Github password and 2fa manually over the RDP
   connection, as copy/paste is not allowed. This is both bad UX and has
   security implications.

2. We have to allow Level 4 VM network access to Github, which is far from
   ideal.


## Decision

We will implement a limited token login option. This token can be generated by
users logged in to their regular browser via Github. To make this as secure as
possible, the following apply:

1. Only users with Github 2fa login and Level 4 access can generate and use
   tokens.
1. Token has a limited duration, and is invalidated by succesful login.
1. Only one valid token per user at any time.
1. Only works from a Level 4 browser, not from internet.
1. User is emailed when token is generated/used to help detect misuse.
1. Login attempts are ratelimited.
1. Token has sufficent entropy, whilst still being easy to type over VPN.


## Consequences

### Pros

Users can much more easily login on Level 4, and we can disable network access
to Github.

### Cons

There is a new way to log in to job-server, provides a new attack vector. The
steps taken above make this very difficult, but it's something to bear in mind
with future authentication changes, which could inadvertently weaken the above
protections.

Detecting Level 4 requests via client IP address is brittle and my not work as
well in other TRE environments.
